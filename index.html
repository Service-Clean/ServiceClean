<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ServiceClean ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∫–ª–∏–Ω–∏–Ω–≥–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f4f7fc;
      color: #1e293b;
      line-height: 1.6;
      padding: 24px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 36px;
      box-shadow: 0 20px 40px -15px rgba(0,0,0,0.1);
      padding: 32px;
    }

    h1 {
      font-size: 2.4em;
      font-weight: 700;
      color: #0b3b5c;
      border-bottom: 4px solid #0b3b5c;
      padding-bottom: 18px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    h1 span {
      background: #0b3b5c;
      color: white;
      font-size: 0.4em;
      padding: 6px 20px;
      border-radius: 50px;
      font-weight: 600;
    }

    h2 {
      color: #0b3b5c;
      margin-bottom: 20px;
      font-size: 1.6em;
      font-weight: 600;
    }

    .user-info {
      background: #f1f5f9;
      padding: 16px 28px;
      border-radius: 60px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    button {
      background: #0b3b5c;
      color: white;
      padding: 12px 28px;
      border: none;
      border-radius: 40px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #1e4f6e;
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px rgba(11,59,92,0.2);
    }

    .btn-outline {
      background: white;
      color: #0b3b5c;
      border: 2px solid #0b3b5c;
    }

    .btn-outline:hover {
      background: #0b3b5c;
      color: white;
    }

    .btn-danger {
      background: #dc2626;
    }

    .btn-danger:hover {
      background: #b91c1c;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: #f8fafc;
      padding: 24px;
      border-radius: 24px;
      text-align: center;
    }

    .stat-value {
      font-size: 2.2em;
      font-weight: 800;
      color: #0b3b5c;
      margin-bottom: 8px;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 12px 28px;
      background: #f1f5f9;
      border-radius: 40px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.2s;
    }

    .tab:hover {
      background: #e2e8f0;
    }

    .tab.active {
      background: #0b3b5c;
      color: white;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .data-table th {
      background: #f1f5f9;
      color: #0b3b5c;
      font-weight: 600;
      padding: 14px;
      text-align: left;
    }

    .data-table td {
      padding: 14px;
      border-bottom: 1px solid #e2e8f0;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 40px;
      font-size: 0.85em;
      font-weight: 600;
    }

    .badge-success { background: #dcfce7; color: #166534; }
    .badge-warning { background: #fff3cd; color: #856404; }
    .badge-info { background: #dbeafe; color: #1e40af; }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 32px;
      border-radius: 32px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal h3 {
      margin-bottom: 24px;
      color: #0b3b5c;
    }

    .modal input, .modal select, .modal textarea {
      width: 100%;
      padding: 12px 16px;
      margin-bottom: 16px;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      font-size: 1em;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .modal-buttons button {
      flex: 1;
    }

    .qr-section {
      margin: 40px 0;
      text-align: center;
    }

    .qr-toggle {
      background: white;
      color: #0b3b5c;
      border: 2px solid #0b3b5c;
      padding: 14px 36px;
      font-size: 1.1em;
    }

    .qr-container {
      display: none;
      margin-top: 25px;
      padding: 25px;
      background: white;
      border: 3px solid #0b3b5c;
      border-radius: 28px;
      max-width: 340px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .qr-container.show {
      display: block;
    }

    .qr-container img {
      width: 220px;
      height: 220px;
      display: block;
      margin: 0 auto;
      border-radius: 16px;
    }

    .qr-text {
      margin-top: 15px;
      font-weight: bold;
      color: #0b3b5c;
      font-size: 1.2em;
    }

    .qr-link {
      font-size: 12px;
      color: #64748b;
      word-break: break-all;
      margin-top: 10px;
      background: #f1f5f9;
      padding: 8px;
      border-radius: 8px;
    }

    .footer {
      margin-top: 40px;
      padding: 32px;
      background: #f8fafc;
      border-radius: 28px;
      text-align: center;
      color: #475569;
    }

    .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .message {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #0b3b5c;
      color: white;
      padding: 16px 24px;
      border-radius: 60px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      z-index: 3000;
      display: none;
    }

    .delete-btn {
      background: #ef4444;
      padding: 6px 12px;
      font-size: 0.9em;
    }

    .delete-btn:hover {
      background: #dc2626;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      üßº ServiceClean 
      <span>–ò–° –¥–ª—è –∫–ª–∏–Ω–∏–Ω–≥–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏</span>
    </h1>

    <!-- –®–∞–ø–∫–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º -->
    <div class="user-info">
      <span id="userStatus">üë§ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
      <button id="authButton" class="btn-outline">üö™ –í—ã–π—Ç–∏</button>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalOrders">0</div>
        <div>–ó–∞–∫–∞–∑–æ–≤ –≤—Å–µ–≥–æ</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalClients">0</div>
        <div>–ö–ª–∏–µ–Ω—Ç–æ–≤</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalEmployees">0</div>
        <div>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalServices">0</div>
        <div>–£—Å–ª—É–≥</div>
      </div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs" id="tabsContainer">
      <div class="tab active" data-tab="orders">üìã –ó–∞–∫–∞–∑—ã</div>
      <div class="tab" data-tab="clients">üë• –ö–ª–∏–µ–Ω—Ç—ã</div>
      <div class="tab" data-tab="employees">üßë‚Äçüîß –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
      <div class="tab" data-tab="services">üß¥ –£—Å–ª—É–≥–∏</div>
      <div class="tab" data-tab="reports">üìä –û—Ç—á—ë—Ç—ã</div>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ó–∞–∫–∞–∑—ã -->
    <div id="tab-orders" class="tab-content">
      <div class="action-bar">
        <h2>üìã –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h2>
        <button id="newOrderBtn">‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑</button>
      </div>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>‚Ññ</th>
            <th>–ö–ª–∏–µ–Ω—Ç</th>
            <th>–£—Å–ª—É–≥–∏</th>
            <th>–î–∞—Ç–∞</th>
            <th>–°—É–º–º–∞</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody id="orders-list">
          <tr><td colspan="7" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –ö–ª–∏–µ–Ω—Ç—ã -->
    <div id="tab-clients" class="tab-content" style="display: none;">
      <div class="action-bar">
        <h2>üë• –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
        <button id="newClientBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
      </div>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>–§–ò–û</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>Email</th>
            <th>–ê–¥—Ä–µ—Å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody id="clients-list">
          <tr><td colspan="6" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ -->
    <div id="tab-employees" class="tab-content" style="display: none;">
      <div class="action-bar">
        <h2>üßë‚Äçüîß –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h2>
        <button id="newEmployeeBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
      </div>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>–§–ò–û</th>
            <th>–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th>–û–∫–ª–∞–¥</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody id="employees-list">
          <tr><td colspan="6" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –£—Å–ª—É–≥–∏ -->
    <div id="tab-services" class="tab-content" style="display: none;">
      <div class="action-bar">
        <h2>üß¥ –£—Å–ª—É–≥–∏ –∫–æ–º–ø–∞–Ω–∏–∏</h2>
        <button id="newServiceBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É</button>
      </div>
      
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–¶–µ–Ω–∞ (‚ÇΩ/–º¬≤)</th>
            <th>–í—Ä–µ–º—è (–º–∏–Ω)</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody id="services-list">
          <tr><td colspan="6" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- –í–∫–ª–∞–¥–∫–∞ –û—Ç—á—ë—Ç—ã -->
    <div id="tab-reports" class="tab-content" style="display: none;">
      <h2>üìä –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã</h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div style="background: #f8fafc; padding: 24px; border-radius: 24px;">
          <h3 style="margin-bottom: 16px;">–í—ã—Ä—É—á–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
          <div id="reports-monthly">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        <div style="background: #f8fafc; padding: 24px; border-radius: 24px;">
          <h3 style="margin-bottom: 16px;">–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —É—Å–ª—É–≥</h3>
          <div id="reports-services">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
      </div>

      <div id="reports-profit" style="background: #dcfce7; padding: 24px; border-radius: 24px; margin-top: 20px;">
        <h3 style="color: #166534;">üí∞ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏: 35%</h3>
      </div>
    </div>

    <!-- QR-–∫–æ–¥ —Å–µ–∫—Ü–∏—è -->
    <div class="qr-section">
      <button id="qrToggleBtn" class="qr-toggle">üì± –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞</button>
      <div id="qrContainer" class="qr-container">
        <img src="https://quickchart.io/qr?text=https://Service-Clean.github.io/ServiceClean/&size=220&margin=0&ecLevel=H&color=0b3b5c" alt="QR-–∫–æ–¥">
        <div class="qr-text">üßº ServiceClean</div>
        <div class="qr-link">https://Service-Clean.github.io/ServiceClean/</div>
      </div>
    </div>

    <!-- –ü–æ–¥–≤–∞–ª -->
    <div class="footer">
      <p>¬© 2026 –û–û–û ¬´–°–µ—Ä–≤–∏—Å–ö–ª–∏–Ω¬ª (ServiceClean) ¬∑ –î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ö–æ–ª–µ—Å–Ω–∏—á–µ–Ω–∫–æ –ê., –ö–æ–±–µ–Ω—è–∫ –ê.</p>
      <p style="margin-top: 8px;">–ì—Ä—É–ø–ø–∞ –ò–°-22 ¬∑ –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å 09.02.07 –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</p>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</h3>
      <form id="modalForm">
        <div id="modalFields"></div>
        <div class="modal-buttons">
          <button type="submit" id="modalSaveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button type="button" id="modalCloseBtn" class="btn-outline">‚úñ –û—Ç–º–µ–Ω–∞</button>
        </div>
      </form>
    </div>
  </div>

  <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
  <div id="message" class="message">–°–æ–æ–±—â–µ–Ω–∏–µ</div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ====== –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö SUPABASE ======
    const SUPABASE_URL = 'https://pyojgyasaccwrcdogexx.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_db9nx0GejLB8Cw7XNB3ACg_FmTeP-WX';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ====== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ======
    let currentUser = null;
    let currentTab = 'orders';
    let currentEditId = null;

    // ====== –í–°–ü–õ–´–í–ê–Æ–©–ï–ï –°–û–û–ë–©–ï–ù–ò–ï ======
    function showMessage(text, isError = false) {
      const msg = document.getElementById('message');
      msg.textContent = text;
      msg.style.background = isError ? '#dc2626' : '#0b3b5c';
      msg.style.display = 'block';
      setTimeout(() => {
        msg.style.display = 'none';
      }, 2000);
    }

    // ====== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ======
    async function loadData() {
      try {
        // –ó–∞–∫–∞–∑—ã
        const { data: orders } = await supabaseClient.from('orders').select('*');
        const ordersList = document.getElementById('orders-list');
        if (orders && orders.length > 0) {
          ordersList.innerHTML = orders.map(item => `
            <tr>
              <td>${item.id}</td>
              <td>${item.client_name || '‚Äî'}</td>
              <td>${item.services || '‚Äî'}</td>
              <td>${item.order_date || '‚Äî'}</td>
              <td>${item.total_price || 0} ‚ÇΩ</td>
              <td><span class="badge badge-info">${item.status || '–Ω–æ–≤—ã–π'}</span></td>
              <td>
                <button class="delete-btn" onclick="deleteItem('orders', ${item.id})">üóëÔ∏è</button>
              </td>
            </tr>
          `).join('');
          document.getElementById('totalOrders').textContent = orders.length;
        }

        // –ö–ª–∏–µ–Ω—Ç—ã
        const { data: clients } = await supabaseClient.from('clients').select('*');
        const clientsList = document.getElementById('clients-list');
        if (clients && clients.length > 0) {
          clientsList.innerHTML = clients.map(item => `
            <tr>
              <td>${item.id}</td>
              <td>${item.full_name || '‚Äî'}</td>
              <td>${item.phone || '‚Äî'}</td>
              <td>${item.email || '‚Äî'}</td>
              <td>${item.address || '‚Äî'}</td>
              <td>
                <button class="delete-btn" onclick="deleteItem('clients', ${item.id})">üóëÔ∏è</button>
              </td>
            </tr>
          `).join('');
          document.getElementById('totalClients').textContent = clients.length;
        }

        // –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
        const { data: employees } = await supabaseClient.from('employees').select('*');
        const employeesList = document.getElementById('employees-list');
        if (employees && employees.length > 0) {
          employeesList.innerHTML = employees.map(item => `
            <tr>
              <td>${item.id}</td>
              <td>${item.full_name || '‚Äî'}</td>
              <td>${item.position || '‚Äî'}</td>
              <td>${item.phone || '‚Äî'}</td>
              <td>${item.salary || 0} ‚ÇΩ</td>
              <td>
                <button class="delete-btn" onclick="deleteItem('employees', ${item.id})">üóëÔ∏è</button>
              </td>
            </tr>
          `).join('');
          document.getElementById('totalEmployees').textContent = employees.length;
        }

        // –£—Å–ª—É–≥–∏
        const { data: services } = await supabaseClient.from('services').select('*');
        const servicesList = document.getElementById('services-list');
        if (services && services.length > 0) {
          servicesList.innerHTML = services.map(item => `
            <tr>
              <td>${item.id}</td>
              <td>${item.name || '‚Äî'}</td>
              <td>${item.description || '‚Äî'}</td>
              <td>${item.price_per_m2 || 0} ‚ÇΩ</td>
              <td>${item.duration || 0} –º–∏–Ω</td>
              <td>
                <button class="delete-btn" onclick="deleteItem('services', ${item.id})">üóëÔ∏è</button>
              </td>
            </tr>
          `).join('');
          document.getElementById('totalServices').textContent = services.length;
        }

        // –û—Ç—á—ë—Ç—ã
        updateReports(orders, services);
      } catch (error) {
        console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', true);
      }
    }

    // ====== –û–ë–ù–û–í–õ–ï–ù–ò–ï –û–¢–ß–Å–¢–û–í ======
    function updateReports(orders, services) {
      // –í—ã—Ä—É—á–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º
      if (orders) {
        const monthlyRevenue = {};
        orders.forEach(order => {
          if (order.order_date) {
            const month = order.order_date.substring(0, 7);
            monthlyRevenue[month] = (monthlyRevenue[month] || 0) + (order.total_price || 0);
          }
        });
        
        const monthsHtml = Object.entries(monthlyRevenue)
          .map(([month, revenue]) => `<div>${month}: ${revenue.toLocaleString()} ‚ÇΩ</div>`)
          .join('');
        document.getElementById('reports-monthly').innerHTML = monthsHtml || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
      }

      // –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å —É—Å–ª—É–≥
      if (services && orders) {
        const serviceCount = {};
        orders.forEach(order => {
          if (order.service_ids) {
            order.service_ids.forEach(id => {
              serviceCount[id] = (serviceCount[id] || 0) + 1;
            });
          }
        });
        
        const servicesHtml = Object.entries(serviceCount)
          .map(([id, count]) => `<div>–£—Å–ª—É–≥–∞ #${id}: ${count} –∑–∞–∫–∞–∑–æ–≤</div>`)
          .join('');
        document.getElementById('reports-services').innerHTML = servicesHtml || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
      }
    }

    // ====== –£–î–ê–õ–ï–ù–ò–ï ======
    window.deleteItem = async function(table, id) {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?')) return;
      
      try {
        const { error } = await supabaseClient
          .from(table)
          .delete()
          .eq('id', id);
        
        if (error) throw error;
        
        showMessage('–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞');
        loadData();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏', true);
      }
    };

    // ====== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ======
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modalTitle');
    const modalFields = document.getElementById('modalFields');
    const modalForm = document.getElementById('modalForm');
    const modalCloseBtn = document.getElementById('modalCloseBtn');

    function showModal(title, fields, table, editId = null) {
      currentEditId = editId;
      modalTitle.textContent = title;
      
      let fieldsHtml = '';
      fields.forEach(field => {
        fieldsHtml += `
          <input 
            type="${field.type || 'text'}" 
            id="modal-${field.name}"
            placeholder="${field.placeholder}"
            value="${field.value || ''}"
            ${field.required ? 'required' : ''}
          >
        `;
      });
      
      modalFields.innerHTML = fieldsHtml;
      modal.classList.add('show');
    }

    modalCloseBtn.addEventListener('click', () => {
      modal.classList.remove('show');
      currentEditId = null;
    });

    modalForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = {};
      const inputs = modalFields.querySelectorAll('input');
      inputs.forEach(input => {
        formData[input.id.replace('modal-', '')] = input.value;
      });

      try {
        let error;
        if (currentEditId) {
          // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
          ({ error } = await supabaseClient
            .from(currentTab)
            .update(formData)
            .eq('id', currentEditId));
        } else {
          // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ
          ({ error } = await supabaseClient
            .from(currentTab)
            .insert([formData]));
        }

        if (error) throw error;
        
        showMessage('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        modal.classList.remove('show');
        currentEditId = null;
        loadData();
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
        showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏', true);
      }
    });

    // ====== –ö–ù–û–ü–ö–ò –î–û–ë–ê–í–õ–ï–ù–ò–Ø ======
    document.getElementById('newOrderBtn').addEventListener('click', () => {
      showModal('‚ûï –ù–æ–≤—ã–π –∑–∞–∫–∞–∑', [
        { name: 'client_name', placeholder: '–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞', type: 'text', required: true },
        { name: 'services', placeholder: '–£—Å–ª—É–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)', type: 'text' },
        { name: 'order_date', placeholder: '–î–∞—Ç–∞', type: 'date', required: true },
        { name: 'total_price', placeholder: '–°—É–º–º–∞', type: 'number' },
        { name: 'status', placeholder: '–°—Ç–∞—Ç—É—Å', type: 'text', value: '–Ω–æ–≤—ã–π' }
      ], 'orders');
    });

    document.getElementById('newClientBtn').addEventListener('click', () => {
      showModal('‚ûï –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç', [
        { name: 'full_name', placeholder: '–§–ò–û', type: 'text', required: true },
        { name: 'phone', placeholder: '–¢–µ–ª–µ—Ñ–æ–Ω', type: 'tel', required: true },
        { name: 'email', placeholder: 'Email', type: 'email' },
        { name: 'address', placeholder: '–ê–¥—Ä–µ—Å', type: 'text' }
      ], 'clients');
    });

    document.getElementById('newEmployeeBtn').addEventListener('click', () => {
      showModal('‚ûï –ù–æ–≤—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫', [
        { name: 'full_name', placeholder: '–§–ò–û', type: 'text', required: true },
        { name: 'position', placeholder: '–î–æ–ª–∂–Ω–æ—Å—Ç—å', type: 'text', required: true },
        { name: 'phone', placeholder: '–¢–µ–ª–µ—Ñ–æ–Ω', type: 'tel', required: true },
        { name: 'salary', placeholder: '–û–∫–ª–∞–¥', type: 'number' }
      ], 'employees');
    });

    document.getElementById('newServiceBtn').addEventListener('click', () => {
      showModal('‚ûï –ù–æ–≤–∞—è —É—Å–ª—É–≥–∞', [
        { name: 'name', placeholder: '–ù–∞–∑–≤–∞–Ω–∏–µ', type: 'text', required: true },
        { name: 'description', placeholder: '–û–ø–∏—Å–∞–Ω–∏–µ', type: 'text' },
        { name: 'price_per_m2', placeholder: '–¶–µ–Ω–∞ –∑–∞ –º¬≤', type: 'number', required: true },
        { name: 'duration', placeholder: '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–º–∏–Ω)', type: 'number' }
      ], 'services');
    });

    // ====== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ======
    function setupTabs() {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.tab-content');

      tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          
          tabs.forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          const tabName = this.getAttribute('data-tab');
          currentTab = tabName;
          
          contents.forEach(content => {
            content.style.display = 'none';
          });
          
          const activeContent = document.getElementById(`tab-${tabName}`);
          if (activeContent) {
            activeContent.style.display = 'block';
          }
        });
      });
    }

    // ====== QR-–ö–û–î ======
    function setupQR() {
      const qrBtn = document.getElementById('qrToggleBtn');
      const qrContainer = document.getElementById('qrContainer');

      if (qrBtn) {
        qrBtn.addEventListener('click', function(e) {
          e.preventDefault();
          qrContainer.classList.toggle('show');
          this.textContent = qrContainer.classList.contains('show') 
            ? 'üì± –°–∫—Ä—ã—Ç—å QR-–∫–æ–¥' 
            : 'üì± –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞';
        });
      }
    }

    // ====== –ü–†–û–í–ï–†–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ======
    async function checkUser() {
      const { data: { user } } = await supabaseClient.auth.getUser();
      currentUser = user;
      document.getElementById('userStatus').innerHTML = user 
        ? `üë§ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: ${user.email || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}`
        : 'üë§ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–¥–µ–º–æ-—Ä–µ–∂–∏–º)';
    }

    // ====== –í–´–•–û–î ======
    function setupAuth() {
      const authBtn = document.getElementById('authButton');
      if (authBtn) {
        authBtn.addEventListener('click', async function(e) {
          e.preventDefault();
          if (currentUser) {
            await supabaseClient.auth.signOut();
            checkUser();
            showMessage('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
          } else {
            showMessage('–í—ã –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ');
          }
        });
      }
    }

    // ====== –ó–ê–ü–£–°–ö ======
    document.addEventListener('DOMContentLoaded', function() {
      setupTabs();
      setupQR();
      setupAuth();
      checkUser();
      loadData();
    });
  </script>
</body>
</html>
